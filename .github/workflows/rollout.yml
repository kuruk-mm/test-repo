name: Rollout

on:
  repository_dispatch:
    types: [deploy]

jobs:
  deploy:
   runs-on: ubuntu-latest
   steps:
    - uses: hmarr/debug-action@v2
    - name: Download artifacts
      run: |
        curl -o unity-renderer-windows.zip https://renderer-artifacts.decentraland.org/desktop/main/unity-renderer-windows.zip
        curl -o unity-renderer-mac.zip https://renderer-artifacts.decentraland.org/desktop/main/unity-renderer-mac.zip
        curl -o unity-renderer-linux.zip https://renderer-artifacts.decentraland.org/desktop/main/unity-renderer-linux.zip
        echo ${{ github.sha }}
    - name: Set version
      shell: bash
      run: |
        COMMIT_HASH=${{ github.sha }}
        DATE=$(date '+%Y%m%d%H%M%S')
        VERSION=1.0.${{github.run_number}}-${DATE}.commit-${COMMIT_HASH::7}
        echo "##[set-output name=number;]$(echo ${VERSION})"
      id: set_version
    - name: Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.extract_branch.outputs.branch }}
        files: |
          unity-renderer-windows.zip
          unity-renderer-mac.zip
          unity-renderer-linux.zip